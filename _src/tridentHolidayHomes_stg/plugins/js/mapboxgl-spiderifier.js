!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("mapbox-gl")):"function"==typeof define&&define.amd?define(["MapboxglSpiderifier"],t):e.MapboxglSpiderifier=t(e.mapboxgl)}(this,function(v){function e(p,e){var u={each:a,map:function(e,n){var i=[];return a(e,function(e,t){i.push(n(e,t))}),i},mapTimes:function(e,t){var n=[];return i(e,function(e){n.push(t(e))}),n},eachTimes:i},t=function(){},f={animate:!1,animationSpeed:0,customPin:!1,initializeLeg:t,onClick:t,circleSpiralSwitchover:9,circleFootSeparation:25,spiralFootSeparation:28,spiralLengthStart:15,spiralLengthFactor:4},h=2*Math.PI,d=[];for(var n in e)f[n]=e[n];function g(){u.each(d.reverse(),function(e,t){f.animate?(e.elements.container.style.transitionDelay=f.animationSpeed/1e3/d.length*t+"s",e.elements.container.className+=" exit",setTimeout(function(){e.mapboxMarker.remove()},f.animationSpeed+100)):e.mapboxMarker.remove()}),d=[]}function a(e,t){var n=0;if(!e||!e.length)return[];for(n=0;n<e.length;n++)t(e[n],n)}function i(e,t){if(!e)return[];for(var n=0;n<e;n++)t(n)}this.spiderfy=function(s,e){var n,m=(t=e.length,t>=f.circleSpiralSwitchover?(o=t,c=f.spiralLengthStart,l=0,u.mapTimes(o,function(e){var t;return l+=f.spiralFootSeparation/c+5e-4*e,t={x:c*Math.cos(l),y:c*Math.sin(l),angle:l,legLength:c,index:e},c+=h*f.spiralLengthFactor/l,t})):(i=t,a=f.circleFootSeparation*(2+i)/h,r=h/i,u.mapTimes(i,function(e){var t=e*r;return{x:a*Math.cos(t),y:a*Math.sin(t),angle:t,legLength:a,index:e}})));var t,i,a,r,o,c,l;g(),n=u.map(e,function(e,t){var n,i,a,r,o,c,l=m[t],p=(n=l,i=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),i.className="spider-leg-container"+(f.animate?" animate initial ":" "),r.className="spider-leg-line",a.className="spider-leg-pin"+(f.customPin?"":" default-spider-pin"),i.appendChild(r),i.appendChild(a),i.style["margin-left"]=n.x+"px",i.style["margin-top"]=n.y+"px",r.style.height=n.legLength+"px",r.style.transform="rotate("+(n.angle-Math.PI/2)+"rad)",{container:i,line:r,pin:a});return o=new v.Marker(p.container).setLngLat(s),c={feature:e,elements:p,mapboxMarker:o,param:l},f.initializeLeg(c),p.container.onclick=function(e){f.onClick(e,c)},c}),u.each(n.reverse(),function(e){e.mapboxMarker.addTo(p)}),f.animate&&setTimeout(function(){u.each(n.reverse(),function(e,t){e.elements.container.className=(e.elements.container.className||"").replace("initial",""),e.elements.container.style.transitionDelay=f.animationSpeed/1e3/n.length*t+"s"})});d=n},this.unspiderfy=g,this.each=function(e){u.each(d,e)}}function a(e,t,n){return[e[0]+(t||0),e[1]+(n||0)]}return e.popupOffsetForSpiderLeg=function(e,t){var n=e.param.x,i=e.param.y;return{top:a([0,t=t||0],n,i),"top-left":a([t,t],n,i),"top-right":a([-t,t],n,i),bottom:a([0,-t],n,i),"bottom-left":a([t,-t],n,i),"bottom-right":a([-t,-t],n,i),left:a([t,-t],n,i),right:a([-t,-t],n,i)}},e});